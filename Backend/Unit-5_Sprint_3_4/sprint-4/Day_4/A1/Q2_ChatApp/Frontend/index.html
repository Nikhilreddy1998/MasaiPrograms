<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <style>
      .hide {
        display: none;
      }
      .show {
        display: block;
      }
    </style>
  </head>
  <body>
    <h3 id="user">Welcome to Chat Application</h3>
    <div id="registerDiv">
      <input id="userName" placeholder="Enter User Name" />
      <button id="registerUserBtn">Register User</button>
    </div>
    <div id="sendMessageDiv" class="hide">
      <input id="sendMessageTag" type="text" placeholder="Enter Message" />
      <button id="sendMessageBtn">Send Message</button>
    </div>
    <div id="chatMessageDiv"></div>
  </body>
  <script type="module">
    import { io } from "https://cdn.socket.io/4.8.1/socket.io.esm.min.js"
    const socket = io("http://localhost:3000")

    let registerUserBtn = document.getElementById("registerUserBtn")
    registerUserBtn.addEventListener("click", () => {
      let userName = document.getElementById("userName").value
      if (userName == "") {
        alert("Enter UserName")
      } else {
        socket.emit("registerUser", userName)
        document.getElementById("user").textContent = `Hi, ${userName}`;
        document.getElementById("registerDiv").style.display = "none"
        let sendMessageDiv = document.getElementById("sendMessageDiv")
        sendMessageDiv.classList.remove("hide")
        sendMessageDiv.classList.add("show")
      }
    })

    /// sendMessage Btn Event
    document.getElementById("sendMessageBtn").addEventListener("click", () => {
      let sendMessageTag = document.getElementById("sendMessageTag")
      console.log(sendMessageTag.value)
      socket.emit("sendMessage", sendMessageTag.value)
      sendMessageTag.value = ""
    });

    socket.on("chat_History", (chatArray) => {
      appendChatIntoUI(chatArray)
    })

    function appendChatIntoUI(chatArray) {
      let chatMessageDiv = document.getElementById("chatMessageDiv")
      chatMessageDiv.innerHTML = ""
      chatArray.map((chat, index) => {
        let chatDiv = document.createElement("div")
        chatDiv.textContent = `${chat.from}:${chat.message}`
        chatMessageDiv.appendChild(chatDiv)
      })
    }

  </script>
</html>
