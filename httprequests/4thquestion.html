<!DOCTYPE html>
<html>
<head>
<title>Task Manager</title>
<style>
  body { font-family: sans-serif; margin: 20px; }
  .task-list { border: 1px solid #ccc; padding: 10px; margin-bottom: 20px; }
  .task-list h2 { margin-top: 0; }
  .task-list ul { list-style: none; padding: 0; }
  .task-item { border-bottom: 1px solid #eee; padding: 5px 0; }
  .edit-modal { display: none; position: fixed; z-index: 1; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.4); }
  .edit-modal-content { background-color: #fefefe; margin: 15% auto; padding: 20px; border: 1px solid #888; width: 50%; }
  .close { color: #aaa; float: right; font-size: 28px; font-weight: bold; }
  .close:hover, .close:focus { color: black; text-decoration: none; cursor: pointer; }
</style>
</head>
<body>

<h1>Task Manager</h1>

<div class="task-list">
  <h2>Tasks</h2>
  <ul id="task-list"></ul>
</div>

<div id="editModal" class="edit-modal">
  <div class="edit-modal-content">
    <span class="close">&times;</span>
    <h2>Edit Task</h2>
    <input type="hidden" id="editTaskId">
    <label for="editTitle">Title:</label>
    <input type="text" id="editTitle"><br><br>
    <label for="editStatus">Status:</label>
    <select id="editStatus">
      <option value="Pending">Pending</option>
      <option value="Completed">Completed</option>
    </select><br><br>
    <button id="saveTask">Save</button>
  </div>
</div>

<script>
  let taskList = document.getElementById('task-list');
  let editModal = document.getElementById('editModal');
  let editTaskId = document.getElementById('editTaskId');
  let editTitle = document.getElementById('editTitle');
  let editStatus = document.getElementById('editStatus');
  let saveTask = document.getElementById('saveTask');
  let closeBtn = document.getElementsByClassName('close')[0];
  let tasks = [];

  async function fetchTasks() {
    try {
      let response = await fetch('https://6566270664fcff8d7309990e.mockapi.io/tasks');
      tasks = await response.json();
      taskList.innerHTML = '';
      tasks.forEach(task => {
        let li = document.createElement('li');
        li.className = 'task-item';
        li.innerHTML = `
          <span>${task.title} - ${task.status}</span>
          <button class="edit-btn" data-id="${task.id}">Edit</button>
          <button class="delete-btn" data-id="${task.id}">Delete</button>
        `;
        taskList.appendChild(li);
      });
      // Call addEventListeners *after* tasks is populated
      addEventListeners(tasks); 
    } catch (error) {
      console.error('Error fetching tasks:', error);
    }
  }

  async function updateTask(id, title, status) {
    try {
      await fetch(`https://6566270664fcff8d7309990e.mockapi.io/tasks/${id}`, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ title, status })
      });
      fetchTasks();
    } catch (error) {
      console.error('Error updating task:', error);
    }
  }

  async function deleteTask(id) {
    try {
      await fetch(`https://6566270664fcff8d7309990e.mockapi.io/tasks/${id}`, { method: 'DELETE' });
      fetchTasks();
    } catch (error) {
      console.error('Error deleting task:', error);
    }
  }

  function addEventListeners(tasks) { // Pass tasks as a parameter
    let editButtons = document.querySelectorAll('.edit-btn');
    editButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        let id = btn.dataset.id;
        let task = tasks.find(t => t.id === id);
        editTaskId.value = id;
        editTitle.value = task.title;
        editStatus.value = task.status;
        editModal.style.display = 'block';
      });
    });

    let deleteButtons = document.querySelectorAll('.delete-btn');
    deleteButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        if (confirm('Are you sure you want to delete this task?')) {
          deleteTask(btn.dataset.id);
        }
      });
    });
  }

  saveTask.addEventListener('click', () => {
    updateTask(editTaskId.value, editTitle.value, editStatus.value);
    editModal.style.display = 'none';
  });

  closeBtn.onclick = function() {
    editModal.style.display = 'none';
  };

  window.onclick = function(event) {
    if (event.target == editModal) {
      editModal.style.display = 'none';
    }
  };

  fetchTasks();
</script>

</body>
</html>